{% extends "base.html" %}
{% load static %}
{% block content %}
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_update %}Edit{% else %}Add{% endif %} trip sheet</title>
<!--</head>-->
<!-- Fontfaces CSS-->
    <link href="{% static 'css/font-face.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-4.7/css/font-awesome.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="{% static 'vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="{% static 'vendor/animsition/animsition.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css' %}" rel="stylesheet"
          media="all">
    <link href="{% static 'vendor/wow/animate.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/slick/slick.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/select2/select2.min.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{% static 'css/theme.css' %}" rel="stylesheet" media="all">
<style>
     body {
            font-family: Public Sans, sans-serif;
            background-color: #f4f4f4;

            margin: 0;
            padding: 0;
            font-size: 14px;
            /*font-weight: 100;*/
            align-items: center;
            color:black;

        }
         .logo p {
        color:white;
        }
        .container_box {
            /*background:#f5f5f5;*/
            background-color:antiquewhite;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /*width: 50%;*/
            border: 2px solid rgb(43, 114, 227);
            margin-left:20px;
            margin-top:100px;
        }


        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        label {

            margin-bottom: 5px;
            /*font-weight: bold;*/
        }

        
        input, select {
            width: 100%;
           /* padding: 8px;*/
            margin-bottom: 10px;
            border: 1px solid black;
            /*border-radius: 5px;*/
            font-size: 14px;
        }
        select {
        padding:3px;
        background:white;

        }
        table {
            background:white;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom:20px;
        }
        .table_input{
            border:none;
        }
        th {
            border: 1px solid black;
            background:#f2f2f2;
            padding:5px;
            text-align: center;
        }
        td {
           border: 1px solid black;
           background:white;
        }
        button {

            padding: 10px;
            background: #28a745;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }
        .btn {
            margin-top: 10px;
            display: inline-block;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            margin-right:10px;
            margin-bottom:20px;
        }
        .save-btn { background-color: #28a745; }
        .back-btn { background-color: #007bff; }

        .input-right {
            text-align: right;
        }
    @media only screen and (max-width: 600px) {
  .container_box  {
    width: 90%;
  }
}
    </style>

 <div class="container_box">

 <div class="container">


<h2>Trip sheet</h2>
    {% if messages %}
    <script>
        window.onload = function() {
            {% for message in messages %}
                alert("{{ message }}");
            {% endfor %}
        }
    </script>
    {% endif %}

<form method="post">
        {% csrf_token %}
        <div class="container">
    <div class="row">
         <div class=" col-md-3 col-6 ">
        <label>Series</label>
             <select name="series" required {% if is_update %}disabled{% endif %}>
            <option value="">Select series</option>
            {% for voucher  in vouchers  %}
                <option value="{{ voucher.id }}" {% if first_trip.series_id.id == voucher.id %}
                selected
            {% endif %}>
                    {{ voucher.series }}
                </option>
            {% endfor %}
        </select><br>
         </div>
         <div class="col-md-2 col-6">
        <label>Order Number</label>
        <input type="text" name="entry_number" id="entry_number" value="{{ first_trip.entry_number|default_if_none:'' }}" readonly required><br>
         </div>
        <div class="col-md-3 col-6">
        <label>Driver Name</label>
        <select name="driver_name" required>
            <option value="">Select Driver</option>
            {% for driver in drivers %}
                <option value="{{ driver.id }}" {% if first_trip.driver_name_id_id == driver.id %}selected{% endif %}>
                    {{ driver.employee_name }}
                </option>
            {% endfor %}
        </select><br>
         </div>

        <div class="col-md-1 "></div>
        <div class="col-md-3 col-6">
        <label>Vehicle Number</label>
        <select name="vehicle_number" id="vehicleSelect" required>
            <option value="">Select Vehicle</option>
            {% for vehicle in vehicles %}
                <option value="{{ vehicle.id }}" {% if first_trip.vehicle_number_id.id == vehicle.id %}selected{% endif %}>
                    {{ vehicle.registration_number }}
                </option>
            {% endfor %}
        </select><br>
         </div>
         <div class="col-md-3 col-6">
        <label>Vehicle Type</label>
        <select name="vehicle_type_id" id="vehicle_type" required>
            <option value="">Select Type</option>
            {% for type in vehicle_types %}
                <option value="{{ type.id }}" {% if first_trip.vehicle_type_id_id == type.id %}selected{% endif %}>
                    {{ type.vehicle_name }}
                </option>
            {% endfor %}
        </select><br>
         </div>


        <div class="col-md-2 col-6">
        <label>Loading Date</label>
        <input type="date" name="loading_date" id="loading_date" value="{{ first_trip.loading_date|date:'Y-m-d' }}" required><br>
         </div>

        <div class="col-md-2 col-6">
        <label>Unloading Date</label>
        <input type="date" name="unloading_date" id="unloading_date" value="{{ first_trip.unloading_date|date:'Y-m-d' }}" required><br>
         </div>


         <div class="col-md-2 col-6">
        <label>Rate Type</label>
        <select name="rate_type" id="rate_type" required>
            <option value="Km Wise" {% if first_trip.rate_type == "Km Wise" %}selected{% endif %}>Km Wise</option>
            <option value="Fixed" {% if first_trip.rate_type == "Fixed" %}selected{% endif %}>Fixed</option>
            <option value="Monthly" {% if first_trip.rate_type == "Monthly" %}selected{% endif %}>Monthly</option>
        </select>
         </div>

    </div>

    <div class="table-responsive">

            <table id="tripTable">
                <thead>
                <tr>
                    <th>Sl.no</th>
                    <th>Customer Name</th>
                    <th>Loading Point</th>
                    <th>Unloading Point</th>
                    <th>Product</th>
                    <th>Remarks</th>
                    <th>action</th>

                </tr>
                </thead>
                <tbody>
            {% if is_update %}
                {% for trip in trips %}
                <tr ondblclick="addRow()">
                    <td style="width:4%;">
                        <input type="text" class="table_input" name="sl_no[]" value="{{ trip.sl_no|default:next_sl_no }}" >
                    </td>
                    <td style="width:25%;">
                        <select name="customer_name[]" class="table_input" id="customerSelect">
                             <option value="">Select Customer</option>
                                {% for customer in customers %}
                                 <option value="{{ customer.id }}" {% if trip.customer_name_id == customer.id %}selected{% endif %}>
                                {{ customer.head }}
                             </option>
                                {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="text" class="table_input" name="loading_point[]" value="{{ trip.loading_point|default_if_none:'' }}" >
                    </td>
                    <td>
                        <input type="text" class="table_input" name="unloading_point[]" value="{{ trip.unloading_point|default_if_none:'' }}" >
                    </td>
                    <td >
                        <input type="text" class="table_input" name="product[]" value="{{ trip.product|default_if_none:'' }}" >
                    </td>
                    <td style="width:10%;">
                        <input type="text" class="table_input" name="remark[]" value="{{ trip.remark|default_if_none:'' }}">
                    </td>
                    <td >
                         <button type="button"  onclick="removeRow(this)" style="background-color:white;padding:0px;">
                              <svg xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 448 512">
            <path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.7 23.7 0 0 0 -21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0 -16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"/>
        </svg>
                         </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                <td colspan="7">No trips found.</td>
                </tr>
                {% endfor %}

        {% else %}
                <tr ondblclick="addRow()">
                    <td style="width:4%;"><input type="text" class="table_input" name="sl_no[]" value="{{ next_sl_no }}"></td>
                    <td style="width:25%;">    <select name="customer_name[]" class="table_input" id="customerSelect">
                             <option value="">Select Customer</option>
                                {% for customer in customers %}
                                 <option value="{{ customer.id }}" {% if trip.customer_id == customer.id %}selected{% endif %}>
                                {{ customer.head }}
                             </option>
                                {% endfor %}
                            </select>
                    </td>
                    <td><input type="text" class="table_input" name="loading_point[]" value=""></td>
                    <td><input type="text" class="table_input" name="unloading_point[]" value=""></td>
                    <td><input type="text" class="table_input" name="product[]" value=""></td>
                    <td style="width:10%;"><input type="text" class="table_input" name="remark[]" value=""></td>
                    <td>
                        <button type="button" onclick="removeRow(this)" style="background-color:white;padding:0px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 448 512">
                                <path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.7 23.7 0 0 0 -21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0 -16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
        {% endif %}
                </tbody>
            </table>

    </div>
        </div>
<div class="row">
    <div class="col-md-4">
        <div class="row">
              	&nbsp;&nbsp;&nbsp;
        <div class="col-md-5 col-12">
        <label>Starting KM</label>
        <input type="number" id="start_km" class="input-right" name="starting_km" value="{{ first_trip.starting_km|default_if_none:'' }}" step="0.1"><br>
        </div>
                <div class="col-md-1"></div>
                &nbsp;&nbsp;
        <div class="col-md-5 col-12">
        <label>Ending KM</label>
        <input type="number" id="end_km" class="input-right" name="ending_km" value="{{ first_trip.ending_km|default_if_none:'' }}" step="0.1"><br>
        </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="row">
                &nbsp;&nbsp;&nbsp;&nbsp;
        <div class="col-md-5 col-12">
        <label>KM Rate</label>
        <input type="number" id="km_rate" class="input-right" name="km_rate" value="{{ first_trip.km_rate|default_if_none:'' }}" step="0.1"><br>
        </div>
                &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        <div class="col-md-5 col-12">
        <label>Filling KM</label>
        <input type="number" class="input-right" name="filling_km" value="{{ first_trip.filling_km|default_if_none:'' }}" step="0.1"><br>
        </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="row">
                 &nbsp;&nbsp;&nbsp;&nbsp;
        <div class="col-md-11 col-12">
        <label>Payment By</label>
            <select name="payment_by">
                <option value="">Select Payment Mode</option>
                <option value="CASH" {% if first_trip.payment_by == "CASH" %}selected{% endif %}>CASH</option>
                <option value="CREDIT" {% if first_trip.payment_by == "CREDIT" %}selected{% endif %}>CREDIT</option>
                <option value="GOOGLE PAY" {% if first_trip.payment_by == "GOOGLE PAY" %}selected{% endif %}>GOOGLE PAY</option>
                <option value="CARD" {% if first_trip.payment_by == "CARD" %}selected{% endif %}>CARD</option>
            </select><br>
        </div>
        </div>
    </div>
</div>
        <div class="row">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <h4>Expense details</h4>
        </div>
<div class="row">
    <div class="col-md-4">


            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Tyre Work</label>
                </div>
                <input type="number" class="input-right" name="tyre_work" value="{{ first_trip.tyre_work|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Battery</label>
                </div>
                <input type="number" class="input-right" name="battery" value="{{ first_trip.battery|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>
            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Mechanical/ Electrical</label>
                </div>
                <input type="number" class="input-right" name="mech_electric" value="{{ first_trip.mech_electric|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Statutory Charge</label>
                </div>
                <input type="number" class="input-right" name="statutory_charge" value="{{ first_trip.statutory_charge|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-7 col-8">
                <label class="me-2">Statutory Narration</label>
                </div>
                <input type="text" name="statutory_narration" value="{{ first_trip.statutory_narration|default_if_none:'' }}">
                &nbsp;&nbsp;
            </div>
    </div>

    <div class="col-md-4" >
            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Total KMs Done</label>
                </div>

                <input id="total_km" type="number" class="input-right" name="total_km" value="{{ first_trip.total_km|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">KM Charge Total</label>
                </div>
                <input type="number" id="km_charge_total" class="input-right" name="km_charge_total" value="{{ first_trip.km_charge_total|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Extra Hour Charge </label>
                </div>
                <input type="number" id="extra_hour_charge_total" class="input-right" name="extra_hour_charge_total" value="{{ first_trip.extra_hour_charge_total|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Fixed Charge Total</label>
                </div>
                <input type="number" id="fixed_charge_total" class="input-right" name="fixed_charge_total" value="{{ first_trip.fixed_charge_total|default_if_none:'' }}" step="0.1" required>
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Haulting Charge Total</label>
                </div>
                <input type="number" id="haulting_charge_total" class="input-right" name="haulting_charge_total" value="{{ first_trip.haulting_charge_total|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Toll/Parking Total</label>
                </div>
                <input type="number" id="toll_parking_total" class="input-right" name="toll_parking_total" value="{{ first_trip.toll_parking_total|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>
    </div>

    <div class="col-md-4" >
            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Diesel LTR</label>
                </div>
                <input type="number" name="diesel_ltr" class="input-right" value="{{ first_trip.diesel_ltr|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Diesel Charges</label>
                </div>
                <input type="number" name="diesel_charges" class="input-right" value="{{ first_trip.diesel_charges|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Advance to Driver</label>
                </div>
                <input type="number" name="advance_driver" class="input-right" value="{{ first_trip.advance_driver|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Driver Bata</label>
                </div>
                <input type="number" name="driver_bata" class="input-right" value="{{ first_trip.driver_bata|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2">Advance from Customer</label>
                </div>
                <input type="number" name="advance_from_customer" class="input-right" value="{{ first_trip.advance_from_customer|default_if_none:'' }}" step="0.1">
                &nbsp;&nbsp;
            </div>

            <div class="d-flex align-items-center ">
                <div class="col-md-8 col-8">
                <label class="me-2 ">Total Freight Charges</label>
                </div>
                <input type="number" id="total_freight_charges" class="bg-success text-white input-right" name="total_freight_charges" value="{{ first_trip.total_freight_charges|default_if_none:'' }}" step="0.1" readonly>
                &nbsp;&nbsp;
            </div>
    </div>
</div>
<!--</div>-->

        <button type="submit" class="btn back-btn">Save</button>
         <a href="{% url 'main:index' %}" class="btn back-btn">Back</a>
</form>


</div>
</div>

<script src="{% static 'vendor/jquery-3.2.1.min.js' %}"></script>
<script>
    $(document).ready(function () {
        $('select[name="series"]').change(function () {
            var seriesId = $(this).val();
            if (seriesId) {
                $.ajax({
                    url: "{% url 'main:get_next_entry_number' %}",
                    data: {
                        'series_id': seriesId
                    },
                    success: function (data) {
                        if (data.entry_number !== undefined) {
                            $('input[name="entry_number"]').val(data.entry_number);
                        }
                        else if (data.error) {
                            // If the server returns an error message
                            alert(data.error);  // Show the error message returned from the server
                        }
                    },
                    error: function () {
                        alert('Could not fetch entry number.');
                    }
                });
            } else {
                $('input[name="entry_number"]').val('');
            }
        });
    });
</script>
<script>

    function addRow() {
        let table = document.getElementById("tripTable").getElementsByTagName('tbody')[0];
        let newRow = table.rows[0].cloneNode(true);

        // Update sl_no based on the row count
        let rowCount = table.rows.length;
        newRow.getElementsByTagName("input")[0].value = rowCount + 1; // Start from 1 and increment

        // Clear other input values
        let inputs = newRow.getElementsByTagName("input");
        for (let i = 1; i < inputs.length; i++) {
            inputs[i].value = "";
        }

        table.appendChild(newRow);
    }

    function removeRow(button) {
        let table = document.getElementById("tripTable").getElementsByTagName('tbody')[0];
        let row = button.closest("tr");

        if (table.rows.length > 1) {
            row.remove();
            resetSlNumbers();  // Reset sl_no after removing a row
        } else {
            alert("At least one row must remain.");
        }
    }

    function resetSlNumbers() {
        let table = document.getElementById("tripTable").getElementsByTagName('tbody')[0];
        let rows = table.getElementsByTagName("tr");

        for (let i = 0; i < rows.length; i++) {
            rows[i].getElementsByTagName("input")[0].value = i + 1; // Reset numbering
        }
    }
</script>
<script>

// load date start here
        document.addEventListener("DOMContentLoaded", function () {
        let today = new Date().toISOString().split('T')[0];
        document.getElementById("loading_date").value = today;
        document.getElementById("unloading_date").value = today;
    });
// load date end here

document.addEventListener("DOMContentLoaded", function () {
    // Get the input fields
    const startKmInput = document.getElementById("start_km");
    const endKmInput = document.getElementById("end_km");
    const totalKmInput = document.getElementById("total_km");
    const kmRateInput = document.getElementById("km_rate");
    const kmChargeTotalInput = document.getElementById("km_charge_total");
    const extraHourChargeTotalInput = document.getElementById("extra_hour_charge_total");
    const fixedChargeTotalInput = document.getElementById("fixed_charge_total");
    const haultingChargeTotalInput = document.getElementById("haulting_charge_total");
    const tollParkingTotalInput = document.getElementById("toll_parking_total");
    const totalFreightChargesInput = document.getElementById("total_freight_charges");

    // Function to calculate total km
    function calculateTotalKm() {
        const startKm = parseFloat(startKmInput.value) || 0;
        const endKm = parseFloat(endKmInput.value) || 0;
        const totalKm = Math.max(endKm - startKm, 0); // Ensure no negative values
        totalKmInput.value = totalKm.toFixed(2);

        // Call function to update km charge total
        calculateKmChargeTotal();
    }

    // Function to calculate KM Charge Total
    function calculateKmChargeTotal() {
        const kmRate = parseFloat(kmRateInput.value) || 0;
        const totalKm = parseFloat(totalKmInput.value) || 0;
        const kmChargeTotal = kmRate * totalKm;

        kmChargeTotalInput.value = kmChargeTotal.toFixed(2);

        // Call function to update total freight charges
        calculateTotalFreightCharges();
    }

    // Function to calculate Total Freight Charges
    function calculateTotalFreightCharges() {
        const kmChargeTotal = parseFloat(kmChargeTotalInput.value) || 0;
        const extraHourChargeTotal = parseFloat(extraHourChargeTotalInput.value) || 0;
        const fixedChargeTotal = parseFloat(fixedChargeTotalInput.value) || 0;
        const haultingChargeTotal = parseFloat(haultingChargeTotalInput.value) || 0;
        const tollParkingTotal = parseFloat(tollParkingTotalInput.value) || 0;

        const totalFreightCharges = kmChargeTotal + extraHourChargeTotal + fixedChargeTotal + haultingChargeTotal + tollParkingTotal;
        totalFreightChargesInput.value = totalFreightCharges.toFixed(2);
    }

    // Attach event listeners
    startKmInput.addEventListener("input", calculateTotalKm);
    endKmInput.addEventListener("input", calculateTotalKm);
    kmRateInput.addEventListener("input", calculateKmChargeTotal);
    totalKmInput.addEventListener("input", calculateKmChargeTotal);
    extraHourChargeTotalInput.addEventListener("input", calculateTotalFreightCharges);
    fixedChargeTotalInput.addEventListener("input", calculateTotalFreightCharges);
    haultingChargeTotalInput.addEventListener("input", calculateTotalFreightCharges);
    tollParkingTotalInput.addEventListener("input", calculateTotalFreightCharges);
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
    const vehicleSelect = document.getElementById("vehicleSelect");
    const customerSelect = document.getElementById("customerSelect");
    const kmRateInput = document.getElementById("km_rate");
    const vehicleType = document.getElementById("vehicle_type");
    const rateSelect = document.getElementById("rate_type");

    function fetchRate() {
        const vehicleId = vehicleSelect.value;
        const customerId = customerSelect.value;
        const rateType = rateSelect.value;

        if (vehicleId) {
            fetch(`/demo.com/get_rate/?vehicle_id=${vehicleId}&customer_id=${customerId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        if (data.vehicle_type_id) {
                            vehicleType.value = data.vehicle_type_id;
                            if (rateType === "Fixed") {
                                kmRateInput.value = 0;
                            }
                        } else {
                            vehicleType.value = "";
                            if (rateType === "Fixed") {
                                kmRateInput.value = 0;
                            }
                        }
                        if (data.rate) {
                            kmRateInput.value = data.rate;
                            if (rateType === "Fixed") {
                                kmRateInput.value = 0;
                            }
                        } else {
                            kmRateInput.value = 0;
                            if (rateType === "Fixed") {
                                kmRateInput.value = 0;
                            }
                        }
                    }
                })
                .catch(err => {
                    console.error("Error fetching rate:", err);
                    kmRateInput.value = "";
                    vehicleType.value = "";
                });
        }
    }


    vehicleSelect.addEventListener("change", fetchRate);
    customerSelect.addEventListener("change", fetchRate);
    rateSelect.addEventListener("change", fetchRate);

});
</script>



<!-- Jquery JS-->

<!-- Bootstrap JS-->
<script src="{% static 'vendor/bootstrap-4.1/popper.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-4.1/bootstrap.min.js' %}"></script>
<!-- Vendor JS       -->
<script src="{% static 'vendor/slick/slick.min.js' %}">
</script>
<script src="{% static 'vendor/wow/wow.min.js' %}"></script>
<script src="{% static 'vendor/animsition/animsition.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap-progressbar/bootstrap-progressbar.min.js' %}">
</script>
<script src="{% static 'vendor/counter-up/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'vendor/counter-up/jquery.counterup.min.js' %}">
</script>
<script src="{% static 'vendor/circle-progress/circle-progress.min.js' %}"></script>
<script src="{% static 'vendor/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
<script src="{% static 'vendor/chartjs/Chart.bundle.min.js' %}"></script>
<script src="{% static 'vendor/select2/select2.min.js' %}">
</script>

<!-- Main JS-->
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
<!--</body>-->

<!--</html>-->
